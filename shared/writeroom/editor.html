<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <style type="text/css" media="screen">
	@font-face { font-family: DejaVuSansMono; src: url('./DejaVuSansMono.ttf'); }
	@font-face { font-family: DejaVuSansMono; font-weight: bold; src: url('./DejaVuSansMono-Bold.ttf'); }
	@font-face { font-family: DejaVuSansMono; font-style: italic; src: url('./DejaVuSansMono-Oblique.ttf'); }
	  
    body {
        overflow: hidden;
    }
        
    #editor { 
        margin: 0;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
	  .ace-tmwr .ace_text-layer {
		  font-family: DejaVuSansMono;
	  }	  
  </style>
</head>
<body>
		
<pre id="editor"></pre>
	
<script src="../ace/src/ace-uncompressed.js" type="text/javascript" charset="utf-8"></script>
<script src="markdown_highlight_rules.js" lang="javascript"></script>
<script src="markdown.js" lang="javascript"></script>
<script src="theme_writeroom.js" lang="javascript"></script>
<script src="writeroom.js" lang="javascript"></script>
<script src="typewriter_session.js" lang="javascript"></script>

<script>
var editor, effect, layoutManager;

var Editor = require("ace/editor").Editor;
var MarkdownMode = require("ace/mode/markdown").Mode;
var LayoutManager = require("writeroom/layout").LayoutManager;
var UndoManager = require("ace/undomanager").UndoManager;
var dom = require("pilot/dom");
var Renderer = require("ace/virtual_renderer").VirtualRenderer;
var TypewriterSession = require("writeroom/typewriter_session").TypewriterSession;
var EditSession = require("ace/edit_session").EditSession;
var Event = require("pilot/event");

var catalog = require("pilot/plugin_manager").catalog;
catalog.registerPlugins([ "pilot/index" ]);

window.onload = function() {

	var elem= document.getElementById("editor");
	var doc = new TypewriterSession(dom.getInnerText(elem), new MarkdownMode());
	doc.setUndoManager(new UndoManager());
	elem.innerHTML = "";
	
	editor = new Editor(new Renderer(elem, "writeroom/theme"));
	editor.setSession(doc);
	
	layoutManager = new LayoutManager(editor);
	
	var centering = layoutManager.layoutCenter(80);
		
	var env = require("pilot/environment").create();
    catalog.startupPlugins({ env: env }).then(function() {
        env.document = doc;
        env.editor = editor;
        editor.resize();
        Event.addListener(window, "resize", function(e) {
            editor.resize();
            centering(e);
        });
        elem.env = env;
    });
    // Store env on editor such that it can be accessed later on from
    // the returned object.
    editor.env = env;

    editor.getSession().setUseWrapMode(true);
	editor.setHighlightActiveLine(false);
	
	editor.renderer.setShowGutter(false);
	editor.renderer.setShowPrintMargin(false);
	editor.renderer.setHScrollBarAlwaysVisible(false);

	// Call layout once, and give automatic focus to the editor
	centering(null);
	editor.focus();
};
</script>

</body>
</html>
